<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BUY.KANS ‚Äî –ö–∞–Ω—Ü–µ–ª—è—Ä–∏—è</title>
  <meta name="description" content="–ö–∞—Ç–∞–ª–æ–≥ BUY.KANS —Å —Ñ–æ—Ç–æ. –ö–æ—Ä–∑–∏–Ω–∞. PDF –∑–∞–∫–∞–∑ —Å —Ç–∞–±–ª–∏—Ü–µ–π –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ WhatsApp." />

  <style>
    :root{
      --bg:#0b1020;
      --card:rgba(255,255,255,.06);
      --card2:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.66);
      --border:rgba(255,255,255,.12);

      --brand:#ff3d7f;
      --brand2:#7c5cff;
      --ok:#25d366;

      --shadow:0 18px 50px rgba(0,0,0,.45);
      --r:18px;
      --r2:26px;
      --max:1100px;
    }

    [data-theme="light"]{
      --bg:#f6f9ff;
      --card:rgba(0,0,0,.04);
      --card2:rgba(0,0,0,.07);
      --text:rgba(10,14,25,.92);
      --muted:rgba(10,14,25,.62);
      --border:rgba(0,0,0,.10);
      --shadow:0 18px 50px rgba(40,60,120,.16);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(124,92,255,.35), transparent 55%),
        radial-gradient(900px 600px at 90% 20%, rgba(255,61,127,.30), transparent 60%),
        radial-gradient(900px 700px at 50% 100%, rgba(42,167,227,.22), transparent 65%),
        var(--bg);
      overflow-x:hidden;
    }

    a{color:inherit; text-decoration:none}
    .wrap{max-width:var(--max); margin:0 auto; padding:16px;}

    /* =========================
       ‚úÖ –í–ï–†–•–ù–Ø–Ø –í–ò–ó–ò–¢–ö–ê (–ù–ï fixed, –ù–ï sticky)
       –û–Ω–∞ —Å—Ç–æ–∏—Ç –¢–û–õ–¨–ö–û —Å–≤–µ—Ä—Ö—É –∏ —É—Ö–æ–¥–∏—Ç –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ.
       ========================= */
    .topCard{
      border:1px solid var(--border);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0));
      border-radius: var(--r2);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .topInner{
      padding:14px;
    }

    .topRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .brand{display:flex; align-items:center; gap:12px;}
    .logo{
      width:44px; height:44px; border-radius:16px;
      display:grid; place-items:center; font-weight:1000;
      background: linear-gradient(135deg, var(--brand2), var(--brand));
      box-shadow: 0 12px 34px rgba(124,92,255,.25);
    }
    .brand h1{margin:0; font-size:16px; letter-spacing:.5px}
    .brand p{margin:0; font-size:12px; color:var(--muted)}

    .navright{
      display:flex; align-items:center; gap:10px;
      flex-wrap:wrap; justify-content:flex-end;
    }

    .chip{
      border:1px solid var(--border);
      background: var(--card);
      border-radius:999px;
      padding:10px 12px;
      display:flex; align-items:center; gap:10px;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
      width:min(520px, 100%);
      flex: 1 1 380px;
    }
    .chip input{
      border:0; outline:0; background:transparent;
      color:var(--text);
      width:100%;
      font-size:14px;
    }

    .miniBtn{
      border:1px solid var(--border);
      background: var(--card);
      color:var(--text);
      padding:10px 12px;
      border-radius:999px;
      cursor:pointer;
      font-weight:900;
      user-select:none;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
      transition: transform .15s ease, background .15s ease;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      white-space:nowrap;
    }
    .miniBtn:hover{background: var(--card2); transform: translateY(-1px);}
    .miniBtn:active{transform: translateY(0) scale(.99);}
    .miniBtn.primary{
      border:0;
      color:#fff;
      background: linear-gradient(135deg, var(--brand2), var(--brand));
    }

    /* ‚úÖ –∫—Ä—É–≥–ª—ã–µ –∫–Ω–æ–ø–∫–∏ */
    .miniBtn.circle{
      width:44px; height:44px;
      padding:0;
      border-radius:999px;
    }
    .miniBtn.circle .lbl{display:none;}
    .miniBtn.circle .ico{font-size:18px; line-height:1;}

    .title{
      margin:12px 0 6px;
      font-size:24px;
      line-height:1.1;
      letter-spacing:-.6px;
    }
    .sub{
      margin:0;
      color:var(--muted);
      font-size:13px;
      line-height:1.5;
      max-width:70ch;
    }

    .clientBox{
      margin-top:12px;
      padding:12px;
      border-radius: var(--r);
      border:1px solid var(--border);
      background: var(--card);
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .field label{display:block; color:var(--muted); font-size:12px; margin-bottom:6px; font-weight:900}
    .field input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background: transparent;
      color: var(--text);
      outline:none;
    }

    .ctaRow{display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;}

    /* =========================
       –ö–∞—Ç–∞–ª–æ–≥
       ========================= */
    .section{padding:14px 0 110px}
    .sectionHead{display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap}
    .sectionHead h2{margin:0; font-size:18px}
    .sectionHead p{margin:0; color:var(--muted); font-size:12px; font-weight:900}

    /* ‚úÖ 2 —Ç–æ–≤–∞—Ä–∞ –≤ —Ä—è–¥ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ —Ç–æ–∂–µ */
    .products{
      margin-top:12px;
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:10px;
    }

    .p{
      padding:10px;
      border-radius: 18px;
      border:1px solid var(--border);
      background: linear-gradient(180deg, var(--card), rgba(255,255,255,0));
      box-shadow: 0 16px 44px rgba(0,0,0,.16);
      overflow:hidden;
    }

    .imgBox{
      border-radius:14px;
      overflow:hidden;
      border:1px solid var(--border);
      background: rgba(255,255,255,.04);
      aspect-ratio: 4 / 3;
      margin-bottom:8px;
    }
    .imgBox img{width:100%; height:100%; object-fit:cover; display:block;}

    .p h3{
      margin:0 0 6px;
      font-size:13px;
      line-height:1.25;
      font-weight:1000;
    }
    .p .desc{display:none;}

    .row{
      margin-top:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }

    .price{display:flex; flex-direction:column; gap:2px;}
    .price b{font-size:14px}
    .price span{color:var(--muted); font-size:10px}

    .qtyWrap{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:nowrap;
    }

    .qtyInput{
      width:48px;
      padding:7px 7px;
      border-radius:10px;
      border:1px solid var(--border);
      background: var(--card);
      color: var(--text);
      outline:none;
      font-weight:1000;
      text-align:center;
    }

    .qtyBtn{
      width:32px; height:32px;
      border-radius:10px;
      border:1px solid var(--border);
      background: var(--card);
      color: var(--text);
      cursor:pointer;
      font-weight:1000;
      display:grid;
      place-items:center;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
      transition: transform .15s ease, background .15s ease;
      user-select:none;
    }

    .setBtn{
      padding:7px 9px;
      border-radius:10px;
      border:1px solid var(--border);
      background: var(--card);
      color:var(--text);
      cursor:pointer;
      font-weight:1000;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
      font-size:12px;
    }
    .setBtn.primary{border:0; color:#fff; background: linear-gradient(135deg, var(--brand2), var(--brand));}

    .clientHint2{margin-top:8px; color:var(--muted); font-size:12px; font-weight:900}

    .empty{
      padding:18px;
      border-radius: var(--r2);
      border:1px dashed rgba(255,255,255,.22);
      background: rgba(255,255,255,.04);
      color: var(--muted);
      font-weight:1000;
      grid-column:1/-1;
      text-align:center;
    }
    [data-theme="light"] .empty{
      border:1px dashed rgba(0,0,0,.18);
      background: rgba(0,0,0,.03);
    }

    /* =========================
       –ù–∏–∂–Ω—è—è –ø–∞–Ω–µ–ª—å (—Å–¥–µ–ª–∞–ª–∏ –º–µ–Ω—å—à–µ)
       ========================= */
    .bar{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:10px; z-index:70;
      width:min(var(--max), calc(100% - 20px));
      border-radius: 18px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      padding:10px;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      box-shadow: var(--shadow);
    }
    [data-theme="light"] .bar{background: rgba(255,255,255,.78);}

    .bar .left{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .count{
      padding:8px 12px;
      border-radius:999px;
      background: var(--card);
      border:1px solid var(--border);
      color:var(--muted);
      font-size:12px;
      font-weight:1000;
      cursor:pointer;
    }
    .bar small{color:var(--muted); font-weight:900; cursor:pointer;}

    .bar .right{display:flex; gap:8px; align-items:center; flex-wrap:wrap; justify-content:flex-end}

    .btn{
      border:1px solid var(--border);
      background: var(--card);
      color:var(--text);
      padding:8px 10px; /* –º–µ–Ω—å—à–µ */
      border-radius:999px;
      cursor:pointer;
      font-weight:1000;
      box-shadow: 0 10px 30px rgba(0,0,0,.12);
      user-select:none;
      font-size:13px;
    }
    .btn.wa{
      border:0; color:#fff;
      padding:9px 10px; /* —á—É—Ç—å –±–æ–ª—å—à–µ, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –º–µ–Ω—å—à–µ */
      background: linear-gradient(135deg, #1fb75a, var(--ok));
    }

    @media (max-width: 560px){
      .wrap{padding:10px;}
      .chip{flex: 1 1 100%;}
      .clientBox{grid-template-columns:1fr;}
      .title{font-size:22px;}

      .bar{
        border-radius: 16px;
        flex-direction:column;
        align-items:stretch;
      }
      .bar .right{
        display:grid;
        grid-template-columns: 1fr 1fr;
        gap:8px;
      }
      #waText{grid-column:1/-1;}
    }

    /* toast */
    .toast{
      position: fixed; left:50%; transform:translateX(-50%);
      top:18px; z-index:90;
      padding:12px 14px;
      border-radius: 14px;
      border:1px solid var(--border);
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(10px);
      color: rgba(255,255,255,.92);
      display:none;
      font-weight:1000;
    }
    [data-theme="light"] .toast{background: rgba(255,255,255,.90); color: rgba(0,0,0,.85);}
    .toast.show{display:block; animation: pop .25s ease;}
    @keyframes pop{from{transform:translateX(-50%) translateY(-6px); opacity:.2} to{transform:translateX(-50%) translateY(0); opacity:1}}

    /* =========================
       –ö–æ—Ä–∑–∏–Ω–∞ (–º–æ–¥–∞–ª–∫–∞)
       ========================= */
    .modal{
      position:fixed; inset:0;
      z-index:120;
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding:12px;
      background: rgba(0,0,0,.45);
      backdrop-filter: blur(6px);
    }
    .modal.show{display:flex;}
    .sheet{
      width:min(var(--max), 100%);
      border-radius: 20px;
      border:1px solid var(--border);
      background: rgba(15,20,40,.92);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    [data-theme="light"] .sheet{ background: rgba(255,255,255,.96); }

    .sheetHead{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 12px;
      border-bottom:1px solid var(--border);
    }
    .sheetHead b{font-size:14px;}
    .sheetHead .x{
      width:38px; height:38px; border-radius:999px;
      border:1px solid var(--border);
      background: var(--card);
      color: var(--text);
      cursor:pointer;
      font-weight:1000;
    }

    .sheetBody{padding:12px; max-height:55vh; overflow:auto;}
    .cartRow{
      display:grid;
      grid-template-columns: 54px 1fr auto;
      gap:10px;
      align-items:center;
      padding:10px 0;
      border-bottom:1px solid rgba(255,255,255,.06);
    }
    [data-theme="light"] .cartRow{border-bottom:1px solid rgba(0,0,0,.06);}

    .cartImg{
      width:54px; height:54px; border-radius:14px;
      border:1px solid var(--border);
      background: var(--card);
      overflow:hidden;
    }
    .cartImg img{width:100%; height:100%; object-fit:cover; display:block;}

    .cartInfo h4{margin:0; font-size:13px; line-height:1.25;}
    .cartInfo small{display:block; margin-top:4px; color:var(--muted); font-weight:900;}

    .cartQty{display:flex; align-items:center; gap:6px;}
    .cartQty .qbtn{
      width:34px; height:34px; border-radius:12px;
      border:1px solid var(--border);
      background: var(--card);
      color:var(--text);
      cursor:pointer;
      font-weight:1000;
      display:grid; place-items:center;
    }
    .cartQty .qval{
      min-width:42px;
      text-align:center;
      padding:7px 8px;
      border-radius:12px;
      border:1px solid var(--border);
      background: var(--card);
      font-weight:1000;
    }

    .sheetFoot{
      padding:12px;
      border-top:1px solid var(--border);
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      justify-content:space-between;
    }
    .sumBox{
      display:flex; gap:10px; align-items:baseline; flex-wrap:wrap;
      color:var(--muted); font-weight:1000;
    }
    .sumBox b{color:var(--text); font-size:14px;}
  </style>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
</head>

<body>
  <div id="top" class="wrap">

    <!-- ‚úÖ –í–ï–†–•–ù–Ø–Ø –í–ò–ó–ò–¢–ö–ê: –¢–û–õ–¨–ö–û –°–í–ï–†–•–£, –£–•–û–î–ò–¢ –ü–†–ò –°–ö–†–û–õ–õ–ï -->
    <div class="topCard">
      <div class="topInner">

        <div class="topRow">
          <div class="brand">
            <div class="logo">BK</div>
            <div>
              <h1>BUY.KANS</h1>
              <p>–®–∫–æ–ª–∞ ‚Ä¢ –û—Ñ–∏—Å ‚Ä¢ –¢–≤–æ—Ä—á–µ—Å—Ç–≤–æ</p>
            </div>
          </div>

          <div class="navright">
            <div class="chip" title="–ü–æ–∏—Å–∫ –ø–æ —Ç–æ–≤–∞—Ä–∞–º">
              üîé <input id="q" placeholder="–ü–æ–∏—Å–∫: —Ç–µ—Ç—Ä–∞–¥—å, —Ä—É—á–∫–∞, –∞—Ä—Ç..." autocomplete="off" />
              <button class="miniBtn" id="clearSearchBtn" type="button" title="–û—á–∏—Å—Ç–∏—Ç—å –ø–æ–∏—Å–∫">‚úï</button>
            </div>

            <button class="miniBtn circle" id="themeBtn" type="button" title="–¢–µ–º–∞">
              <span class="ico">üåì</span><span class="lbl">–¢–µ–º–∞</span>
            </button>

            <button class="miniBtn primary circle" id="scrollCatalogBtn" type="button" title="–ö–∞—Ç–∞–ª–æ–≥">
              <span class="ico">üì¶</span><span class="lbl">–ö–∞—Ç–∞–ª–æ–≥</span>
            </button>

            <a class="miniBtn circle" href="https://t.me/stationerybaisat" target="_blank" rel="noreferrer" title="Telegram">
              <span class="ico">‚úàÔ∏è</span><span class="lbl">Telegram</span>
            </a>

            <a class="miniBtn circle" href="https://wa.me/77074975195" target="_blank" rel="noreferrer" title="WhatsApp">
              <span class="ico">üí¨</span><span class="lbl">WhatsApp</span>
            </a>
          </div>
        </div>

        <h2 class="title">–ö–∞—Ç–∞–ª–æ–≥ BUY.KANS</h2>
        <p class="sub">–í—ã–±–∏—Ä–∞–π —Ç–æ–≤–∞—Ä—ã ‚Üí –≤–≤–æ–¥–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ ‚Üí —Å–º–æ—Ç—Ä–∏ –∫–æ—Ä–∑–∏–Ω—É ‚Üí –æ—Ç–ø—Ä–∞–≤–ª—è–π –∑–∞–∫–∞–∑ –≤ WhatsApp.</p>

        <div class="clientBox">
          <div class="field">
            <label for="clientName">–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</label>
            <input id="clientName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê—Å–µ–º" autocomplete="name" />
          </div>
          <div class="field">
            <label for="clientCity">–ì–æ—Ä–æ–¥</label>
            <input id="clientCity" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–ª–º–∞—Ç—ã" autocomplete="address-level2" />
          </div>
        </div>

        <div class="ctaRow">
          <button class="miniBtn" id="clearCartBtn" type="button">üßπ –û—á–∏—Å—Ç–∏—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
          <button class="miniBtn" id="openCartBtn" type="button">üß∫ –û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É</button>
        </div>
      </div>
    </div>

    <section id="catalog" class="section">
      <div class="sectionHead">
        <div>
          <h2>–ö–∞—Ç–∞–ª–æ–≥</h2>
          <p id="resultsHint">–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é / –∞—Ä—Ç–∏–∫—É–ª—É</p>
        </div>
      </div>

      <div class="products" id="products"></div>
    </section>
  </div>

  <!-- bottom bar -->
  <div class="bar">
    <div class="left">
      <span class="count" id="cartCount" title="–û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É">–ö–æ—Ä–∑–∏–Ω–∞: 0</span>
      <small id="cartSum" title="–û—Ç–∫—Ä—ã—Ç—å –∫–æ—Ä–∑–∏–Ω—É">–°—É–º–º–∞: 0 ‚Ç∏</small>
    </div>
    <div class="right">
      <button class="btn wa" id="waText" type="button">üí¨ –ó–∞–∫–∞–∑ –≤ WhatsApp</button>
      <button class="btn" id="pdfBtn" type="button">üìÑ PDF</button>
      <button class="btn" id="sharePdfBtn" type="button">üì§ Share</button>
    </div>
  </div>

  <div class="toast" id="toast">–ì–æ—Ç–æ–≤–æ</div>

  <!-- CART MODAL -->
  <div class="modal" id="cartModal" aria-hidden="true">
    <div class="sheet" role="dialog" aria-modal="true" aria-label="–ö–æ—Ä–∑–∏–Ω–∞">
      <div class="sheetHead">
        <b>üß∫ –ö–æ—Ä–∑–∏–Ω–∞</b>
        <button class="x" id="closeCartBtn" type="button" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="sheetBody" id="cartModalBody"></div>
      <div class="sheetFoot">
        <div class="sumBox">
          <span>–ò—Ç–æ–≥–æ:</span> <b id="cartModalTotal">0 ‚Ç∏</b>
        </div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; justify-content:flex-end;">
          <button class="btn" id="cartModalClear" type="button">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
          <button class="btn wa" id="cartModalSendWa" type="button">üí¨ –û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PDF AREA -->
  <div id="pdfArea" style="position:fixed; left:-99999px; top:0; width:794px; background:#fff; color:#111; padding:28px; font-family:Arial, sans-serif;">
    <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:12px;">
      <div>
        <div style="font-size:22px; font-weight:900; letter-spacing:2px;">BUY.KANS</div>
        <div style="font-size:12px; color:#666; margin-top:4px;">–ó–∞–∫–∞–∑ –∫–ª–∏–µ–Ω—Ç–∞</div>
        <div style="font-size:12px; color:#333; margin-top:10px;">
          <div><b>–ò–º—è:</b> <span id="pdfClientName">‚Äî</span></div>
          <div style="margin-top:4px;"><b>–ì–æ—Ä–æ–¥:</b> <span id="pdfClientCity">‚Äî</span></div>
        </div>
      </div>
      <div style="text-align:right; font-size:12px; color:#444;">
        <div id="pdfDate"></div>
        <div style="margin-top:8px;">WhatsApp: +7 707 497 5195</div>
        <div style="margin-top:2px;">Telegram: @stationerybaisat</div>
      </div>
    </div>

    <hr style="border:none; border-top:1px solid #e6e6e6; margin:14px 0 16px;">

    <div style="margin-top:8px; font-size:14px; font-weight:800;">–°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤</div>

    <table style="width:100%; border-collapse:collapse; margin-top:10px; font-size:13px;">
      <thead>
        <tr style="background:#f4f6ff;">
          <th style="text-align:left; padding:10px; border:1px solid #e6e6e6; width:64px;">–§–æ—Ç–æ</th>
          <th style="text-align:left; padding:10px; border:1px solid #e6e6e6;">–¢–æ–≤–∞—Ä</th>
          <th style="text-align:center; padding:10px; border:1px solid #e6e6e6; width:70px;">–ö–æ–ª-–≤–æ</th>
          <th style="text-align:right; padding:10px; border:1px solid #e6e6e6; width:110px;">–¶–µ–Ω–∞</th>
          <th style="text-align:right; padding:10px; border:1px solid #e6e6e6; width:120px;">–°—É–º–º–∞</th>
        </tr>
      </thead>
      <tbody id="pdfRows"></tbody>
    </table>

    <div style="display:flex; justify-content:flex-end; margin-top:14px;">
      <div style="min-width:280px; font-size:13px;">
        <div style="display:flex; justify-content:space-between; padding:8px 0;">
          <span style="color:#555;">–ò—Ç–æ–≥–æ:</span>
          <b id="pdfTotal">0 ‚Ç∏</b>
        </div>
      </div>
    </div>

    <div style="margin-top:12px; font-size:12px; color:#666;">
      –°–ø–∞—Å–∏–±–æ –∑–∞ –∑–∞–∫–∞–∑ ‚ù§Ô∏è BUY.KANS
    </div>
  </div>

  <script>
    const BASE = location.origin + location.pathname.replace(/\/[^\/]*$/, "/");
    const SHOP = { phoneWa: "77074975195" };

    // ‚úÖ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –ø–æ–ª–æ–∂–∏ –≤ /images —Ä—è–¥–æ–º —Å index.html
    const PRODUCTS = [
  {
    id:"set-20006",
    name:"–ù–∞–±–æ—Ä (–∞—Ä—Ç 20006)",
    price:1500,
    img:BASE+"images/20006.jpg",
    desc:"–ù–∞–±–æ—Ä —Å –±–ª–æ–∫–Ω–æ—Ç–æ–º –∏ —Ä—É—á–∫–æ–π."
  },
  {
    id:"demo-clock",
    name:"–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∞“ì–∞—Ç",
    price:180,
    img:BASE+"images/demo-clock.jpg",
    desc:"–£—á–µ–±–Ω—ã–µ —á–∞—Å—ã."
  },
  {
    id:"notebook-2515",
    name:"–ë–ª–æ–∫–Ω–æ—Ç Barbie (–∞—Ä—Ç 2515)",
    price:450,
    img:BASE+"images/barbie-2515.jpg",
    desc:"–ë–ª–æ–∫–Ω–æ—Ç Barbie."
  },
  {
    id:"biser-307-10",
    name:"–ë–∏—Å–µ—Ä ‚Äî –Ω–∞–±–æ—Ä (–∞—Ä—Ç 307-10)",
    price:480,
    img:BASE+"images/biser-307-10.jpg",
    desc:"–ù–∞–±–æ—Ä –±–∏—Å–µ—Ä–∞."
  },
  {
    id:"stickers-smile",
    name:"–ù–∞–∫–ª–µ–π–∫–∏ ¬´–°–º–∞–π–ª–∏–∫¬ª",
    price:120,
    img:BASE+"images/stickers-smile.jpg",
    desc:"–ù–∞–∫–ª–µ–π–∫–∏."
  },
  {
    id:"lupa-5x",
    name:"–õ—É–ø–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π (–∞—Ä—Ç 5x)",
    price:1800,
    img: BASE + "images/lupa-5x.jpg",
    desc:"–õ—É–ø–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π. –í –∫–æ—Ä–æ–±–∫–µ 40 —à—Ç."
  },
  {
    id:"markers-5-1",
    name:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã (–∞—Ä—Ç 5+1)",
    price:120,
    img: BASE + "images/markers-5-1.jpg",
    desc:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã 5+1."
  },
  {
    id:"markers-7-1",
    name:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã (–∞—Ä—Ç 7+1)",
    price:180,
    img: BASE + "images/markers-7-1.jpg",
    desc:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã 7+1."
  },
  {
    id:"markers-9-1",
    name:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã (–∞—Ä—Ç 9+1)",
    price:250,
    img: BASE + "images/markers-9-1.jpg",
    desc:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã 9+1."
  },
  {
    id:"markers-1686-6",
    name:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã 6 —Ü–≤–µ—Ç–æ–≤ (–∞—Ä—Ç 1686-6)",
    price:100,
    img: BASE + "images/markers-1686-6.jpg",
    desc:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã 6 —Ü–≤–µ—Ç–æ–≤."
  },
  {
    id:"markers-td-6865-06",
    name:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã 6 —Ü–≤–µ—Ç–æ–≤ (–∞—Ä—Ç TD-6865-06)",
    price:100,
    img: BASE + "images/markers-td-6865-06.jpg",
    desc:"–§–ª–æ–º–∞—Å—Ç–µ—Ä—ã 6 —Ü–≤–µ—Ç–æ–≤."
  },
  {
    id:"pikmi-stick",
    name:"–ü–∏–∫–º–∏ –ø–∞–ª–æ—á–∫–∞",
    price:150,
    img: BASE + "images/pikmi-stick.jpg",
    desc:"–ü–∏–∫–º–∏ –ø–∞–ª–æ—á–∫–∞."
  },
  {
    id:"pikmi-stick-big",
    name:"–ë–æ–ª—å—à–∞—è –ø–∏–∫–º–∏ –ø–∞–ª–æ—á–∫–∞",
    price:450,
    img: BASE + "images/pikmi-stick-big.jpg",
    desc:"–í –ø–∞—á–∫–µ 12 —à—Ç."
  },
  {
    id:"notebook-a5-580",
    name:"–ë–ª–æ–∫–Ω–æ—Ç (–∞—Ä—Ç A5-580)",
    price:550,
    img: BASE + "images/notebook-a5-580.jpg",
    desc:"–ë–ª–æ–∫–Ω–æ—Ç A5-580."
  },
  {
    id:"touch-marker-30",
    name:"Touch –º–∞—Ä–∫–µ—Ä—ã 30 —Ü–≤–µ—Ç–æ–≤",
    price:1200,
    img: BASE + "images/touch-marker-30.jpg",
    desc:"–ù–∞–±–æ—Ä Touch –º–∞—Ä–∫–µ—Ä–æ–≤, 30 —Ü–≤–µ—Ç–æ–≤."
  },
  {
    id:"notebook-5221",
    name:"–ë–ª–æ–∫–Ω–æ—Ç (–∞—Ä—Ç 5221)",
    price:550,
    img: BASE + "images/notebook-5221.jpg",
    desc:"–ë–ª–æ–∫–Ω–æ—Ç 5221."
  },
  {
    id:"notebook-yl-a5-805",
    name:"–ë–ª–æ–∫–Ω–æ—Ç (–∞—Ä—Ç YL-A5-805)",
    price:550,
    img: BASE + "images/notebook-yl-a5-805.jpg",
    desc:"–ë–ª–æ–∫–Ω–æ—Ç YL-A5-805."
  },
  {
    id:"notebook-2502",
    name:"–ë–ª–æ–∫–Ω–æ—Ç (–∞—Ä—Ç 2502)",
    price:300,
    img: BASE + "images/notebook-2502.jpg",
    desc:"–ë–ª–æ–∫–Ω–æ—Ç 2502."
  },
  {
    id:"notebook-7125-1",
    name:"–ë–ª–æ–∫–Ω–æ—Ç (–∞—Ä—Ç 7125-1)",
    price:280,
    img: BASE + "images/notebook-7125-1.jpg",
    desc:"–ë–ª–æ–∫–Ω–æ—Ç 7125-1."
  },
  {
    id:"coloring-4578",
    name:"–†–∞—Å–∫—Ä–∞—Å–∫–∞ (–∞—Ä—Ç 4578)",
    price:650,
    img: BASE + "images/coloring-4578.jpg",
    desc:"–†–∞—Å–∫—Ä–∞—Å–∫–∞ 4578."
  },
  {
    id:"plasticine-6",
    name:"–ü–ª–∞—Å—Ç–∏–ª–∏–Ω 6 —Ü–≤–µ—Ç–æ–≤ (–∞—Ä—Ç YL242802-6)",
    price:260,
    img: BASE + "images/plasticine-6.jpg",
    desc:"–ü–ª–∞—Å—Ç–∏–ª–∏–Ω 6 —Ü–≤–µ—Ç–æ–≤."
  },
  {
    id:"plasticine-8",
    name:"–ü–ª–∞—Å—Ç–∏–ª–∏–Ω 8 —Ü–≤–µ—Ç–æ–≤ (–∞—Ä—Ç YL242802-8)",
    price:325,
    img: BASE + "images/plasticine-8.jpg",
    desc:"–ü–ª–∞—Å—Ç–∏–ª–∏–Ω 8 —Ü–≤–µ—Ç–æ–≤."
  },
  {
    id:"plasticine-10",
    name:"–ü–ª–∞—Å—Ç–∏–ª–∏–Ω 10 —Ü–≤–µ—Ç–æ–≤ (–∞—Ä—Ç YL242802-10)",
    price:420,
    img: BASE + "images/plasticine-10.jpg",
    desc:"–ü–ª–∞—Å—Ç–∏–ª–∏–Ω 10 —Ü–≤–µ—Ç–æ–≤."
  },
  {
    id:"plasticine-12",
    name:"–ü–ª–∞—Å—Ç–∏–ª–∏–Ω 12 —Ü–≤–µ—Ç–æ–≤ (–∞—Ä—Ç YL242802-12)",
    price:450,
    img: BASE + "images/plasticine-12.jpg",
    desc:"–ü–ª–∞—Å—Ç–∏–ª–∏–Ω 12 —Ü–≤–µ—Ç–æ–≤."
  },
{
  id:"hand-pump",
  name:"–†—É—á–Ω–æ–π –Ω–∞—Å–æ—Å",
  price:300,
  img: BASE + "images/hand-pump.jpg",
  desc:"–†—É—á–Ω–æ–π –Ω–∞—Å–æ—Å."
},
{
  id:"laser-pointer-pen",
  name:"–õ–∞–∑–µ—Ä–Ω–∞—è —Ä—É—á–∫–∞-—É–∫–∞–∑–∫–∞",
  price:550,
  img: BASE + "images/laser-pointer-pen.jpg",
  desc:"–õ–∞–∑–µ—Ä–Ω–∞—è —Ä—É—á–∫–∞-—É–∫–∞–∑–∫–∞."
},
{
  id:"compass-adrianov",
  name:"–ö–æ–º–ø–∞—Å –ê–¥—Ä–∏–∞–Ω–æ–≤–∞",
  price:1800,
  img: BASE + "images/compass-adrianov.jpg",
  desc:"–ö–æ–º–ø–∞—Å –ê–¥—Ä–∏–∞–Ω–æ–≤–∞."
},
{
  id:"tasbih",
  name:"–¢–∞—Å–ø–∏—Ö",
  price:120,
  img: BASE + "images/tasbih.jpg",
  desc:"–¢–∞—Å–ø–∏—Ö."
},
{
  id:"cup-16729-s",
  name:"–ö—É–±–æ–∫ (–∞—Ä—Ç 16729 –°)",
  price:1200,
  img: BASE + "images/cup-16729-s.jpg",
  desc:"–ö—É–±–æ–∫. –ê—Ä—Ç 16729 –°."
},
{
  id:"notebook-yl-e-820",
  name:"–ë–ª–æ–∫–Ω–æ—Ç A5 (–∞—Ä—Ç YL-E-820)",
  price:850,
  img: BASE + "images/notebook-yl-e-820.jpg",
  desc:"–ë–ª–æ–∫–Ω–æ—Ç A5."
},
{
  id:"calculator-yl888",
  name:"–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä (–∞—Ä—Ç YL888)",
  price:2300,
  img: BASE + "images/calculator-yl888.jpg",
  desc:"–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä."
},
      {
  id:"lupa-gold-70",
  name:"–õ—É–ø–∞ –∑–æ–ª–æ—Ç–∏—Å—Ç–∞—è 70 –º–º",
  price:500,
  img: BASE + "images/lupa-gold-70.jpg",
  desc:"–õ—É–ø–∞ –∑–æ–ª–æ—Ç–∏—Å—Ç–∞—è, –¥–∏–∞–º–µ—Ç—Ä 70 –º–º."
},
{
  id:"lupa-gold-60",
  name:"–õ—É–ø–∞ –∑–æ–ª–æ—Ç–∏—Å—Ç–∞—è 60 –º–º",
  price:450,
  img: BASE + "images/lupa-gold-60.jpg",
  desc:"–õ—É–ø–∞ –∑–æ–ª–æ—Ç–∏—Å—Ç–∞—è, –¥–∏–∞–º–µ—Ç—Ä 60 –º–º."
},
{
  id:"rhinestones-butterfly",
  name:"–°—Ç—Ä–∞–∑—ã ¬´–ë–∞–±–æ—á–∫–∞¬ª",
  price:250,
  img: BASE + "images/rhinestones-butterfly.jpg",
  desc:"–°—Ç—Ä–∞–∑—ã –±–∞–±–æ—á–∫–∞. –¶–µ–Ω–∞ –∑–∞ 1 —à—Ç."
},
{
  id:"rhinestones-hair-tft01",
  name:"–°—Ç—Ä–∞–∑—ã –¥–ª—è –≤–æ–ª–æ—Å (–∞—Ä—Ç TFT01)",
  price:250,
  img: BASE + "images/rhinestones-hair-tft01.jpg",
  desc:"–°—Ç—Ä–∞–∑—ã –¥–ª—è –≤–æ–ª–æ—Å. –ê—Ä—Ç TFT01. –¶–µ–Ω–∞ –∑–∞ 1 —à—Ç."
},
{
  id:"rhinestones-nails",
  name:"–°—Ç—Ä–∞–∑—ã –¥–ª—è –Ω–æ–≥—Ç–µ–π",
  price:200,
  img: BASE + "images/rhinestones-nails.jpg",
  desc:"–°—Ç—Ä–∞–∑—ã –¥–ª—è –Ω–æ–≥—Ç–µ–π. –¶–µ–Ω–∞ –∑–∞ 1 —à—Ç."
},
{
  id:"rhinestones-tz-11",
  name:"–°—Ç—Ä–∞–∑—ã (–∞—Ä—Ç TZ-11)",
  price:200,
  img: BASE + "images/rhinestones-tz-11.jpg",
  desc:"–°—Ç—Ä–∞–∑—ã. –ê—Ä—Ç TZ-11. –¶–µ–Ω–∞ –∑–∞ 1 —à—Ç."
},
{
  id:"rhinestones-ny-013",
  name:"–°—Ç—Ä–∞–∑—ã (–∞—Ä—Ç NY-013)",
  price:250,
  img: BASE + "images/rhinestones-ny-013.jpg",
  desc:"–°—Ç—Ä–∞–∑—ã. –ê—Ä—Ç NY-013. –¶–µ–Ω–∞ –∑–∞ 1 —à—Ç."
},
{
  id:"rhinestones-ykl-015",
  name:"–°—Ç—Ä–∞–∑—ã (–∞—Ä—Ç YKL-015)",
  price:200,
  img: BASE + "images/rhinestones-ykl-015.jpg",
  desc:"–°—Ç—Ä–∞–∑—ã. –ê—Ä—Ç YKL-015. –¶–µ–Ω–∞ –∑–∞ 1 —à—Ç."
},
{
  id:"set-stickers-tape-sl08",
  name:"–ù–∞–±–æ—Ä: –Ω–∞–∫–ª–µ–π–∫–∏ + –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —Å–∫–æ—Ç—á–∏ (–∞—Ä—Ç SL08)",
  price:350,
  img: BASE + "images/set-stickers-tape-sl08.jpg",
  desc:"–ù–∞–±–æ—Ä –Ω–∞–∫–ª–µ–µ–∫ –∏ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã—Ö —Å–∫–æ—Ç—á–µ–π. –ê—Ä—Ç SL08."
}
];

    const elQ = document.getElementById("q");
    const clearSearchBtn = document.getElementById("clearSearchBtn");
    const resultsHint = document.getElementById("resultsHint");
    const elProducts = document.getElementById("products");

    const clearCartBtn = document.getElementById("clearCartBtn");
    const openCartBtn = document.getElementById("openCartBtn");
    const scrollCatalogBtn = document.getElementById("scrollCatalogBtn");

    const themeBtn = document.getElementById("themeBtn");
    const elCartCount = document.getElementById("cartCount");
    const elCartSum = document.getElementById("cartSum");
    const elToast = document.getElementById("toast");

    const btnWaText = document.getElementById("waText");
    const btnPdf = document.getElementById("pdfBtn");
    const btnSharePdf = document.getElementById("sharePdfBtn");

    const clientName = document.getElementById("clientName");
    const clientCity = document.getElementById("clientCity");

    const pdfArea = document.getElementById("pdfArea");
    const pdfRows = document.getElementById("pdfRows");
    const pdfTotal = document.getElementById("pdfTotal");
    const pdfDate = document.getElementById("pdfDate");
    const pdfClientName = document.getElementById("pdfClientName");
    const pdfClientCity = document.getElementById("pdfClientCity");

    const cartModal = document.getElementById("cartModal");
    const cartModalBody = document.getElementById("cartModalBody");
    const cartModalTotal = document.getElementById("cartModalTotal");
    const closeCartBtn = document.getElementById("closeCartBtn");
    const cartModalClear = document.getElementById("cartModalClear");
    const cartModalSendWa = document.getElementById("cartModalSendWa");

    const cart = new Map(); // id -> qty

    const fmt = (n)=> new Intl.NumberFormat("ru-RU").format(Number(n||0));
    const escapeHtml = (s)=> String(s).replace(/[&<>"']/g, m=>({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
    }[m]));
    const norm = (s)=> String(s||"")
      .toLowerCase()
      .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
      .replace(/—ë/g,"–µ")
      .trim();

    function toast(msg){
      elToast.textContent = msg;
      elToast.classList.add("show");
      clearTimeout(window.__t);
      window.__t = setTimeout(()=> elToast.classList.remove("show"), 1300);
    }

    function saveCart(){
      const obj = {};
      cart.forEach((v,k)=> obj[k]=v);
      localStorage.setItem("bk_cart", JSON.stringify(obj));
    }
    function loadCart(){
      try{
        const obj = JSON.parse(localStorage.getItem("bk_cart") || "{}");
        Object.entries(obj).forEach(([k,v])=>{
          const n = Number(v)||0;
          if(n>0) cart.set(k,n);
        });
      }catch(e){}
    }

    function saveClient(){
      localStorage.setItem("bk_client_name", clientName.value.trim());
      localStorage.setItem("bk_client_city", clientCity.value.trim());
    }
    function loadClient(){
      clientName.value = localStorage.getItem("bk_client_name") || "";
      clientCity.value = localStorage.getItem("bk_client_city") || "";
    }
    clientName.addEventListener("input", saveClient);
    clientCity.addEventListener("input", saveClient);

    function getClient(){
      return { name:(clientName.value||"").trim(), city:(clientCity.value||"").trim() };
    }

    function cartItems(){
      const items = [];
      cart.forEach((qty,id)=>{
        const p = PRODUCTS.find(x=>x.id===id);
        if(p) items.push({p, qty});
      });
      return items;
    }

    function cartTotal(){
      return cartItems().reduce((sum, it)=> sum + (Number(it.p.price)||0) * it.qty, 0);
    }

    function updateBar(){
      const itemsCount = cartItems().reduce((s,it)=>s+it.qty,0);
      elCartCount.textContent = `–ö–æ—Ä–∑–∏–Ω–∞: ${itemsCount}`;
      elCartSum.textContent = `–°—É–º–º–∞: ${fmt(cartTotal())} ‚Ç∏`;
    }

    // theme
    const savedTheme = localStorage.getItem("bk_theme");
    if(savedTheme) document.documentElement.setAttribute("data-theme", savedTheme);
    themeBtn.addEventListener("click", ()=>{
      const cur = document.documentElement.getAttribute("data-theme") || "dark";
      const next = cur === "light" ? "dark" : "light";
      document.documentElement.setAttribute("data-theme", next);
      localStorage.setItem("bk_theme", next);
    });

    // search
    function applySearchInput(){ renderProducts(); }
    let searchTimer = null;
    function debounceSearch(){
      clearTimeout(searchTimer);
      searchTimer = setTimeout(applySearchInput, 120);
    }
    elQ.addEventListener("input", debounceSearch);
    elQ.addEventListener("keydown", (e)=>{ if(e.key==="Enter") applySearchInput(); });

    clearSearchBtn.addEventListener("click", ()=>{
      elQ.value = "";
      renderProducts();
      elQ.focus();
    });

    function setQty(id, qty){
      const n = Math.max(0, Math.min(9999, Number(qty)||0));
      if(n===0) cart.delete(id);
      else cart.set(id, n);
      saveCart();
      updateBar();
      if(cartModal.classList.contains("show")) renderCartModal();
    }

    function renderProducts(){
      const q = norm(elQ.value);
      const list = PRODUCTS.filter(p=>{
        const hay = norm((p.name||"") + " " + (p.desc||""));
        return !q || hay.includes(q);
      });

      resultsHint.textContent = q
        ? `–†–µ–∑—É–ª—å—Ç–∞—Ç—ã: "${elQ.value.trim()}" ‚Ä¢ –Ω–∞–π–¥–µ–Ω–æ: ${list.length}`
        : `–¢–æ–≤–∞—Ä–æ–≤: ${list.length}`;

      elProducts.innerHTML = "";

      if(list.length===0){
        elProducts.innerHTML = `<div class="empty">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üòï</div>`;
        updateBar();
        return;
      }

      list.forEach(p=>{
        const qty = cart.get(p.id) || 0;
        const priceText = `${fmt(p.price)} ‚Ç∏`;

        const card = document.createElement("div");
        card.className = "p";
        card.innerHTML = `
          <div class="imgBox">
            <img src="${p.img}" alt="${escapeHtml(p.name)}" loading="lazy"
              onerror="this.style.display='none'; this.parentElement.textContent='üñº –§–æ—Ç–æ –Ω–µ—Ç';">
          </div>

<h3>${escapeHtml(p.name)}</h3>

          <div class="row">
            <div class="price">
              <b>${priceText}</b>
              <span>–∑–∞ 1 —à—Ç</span>
            </div>

            <div class="qtyWrap">
              <button class="qtyBtn" type="button" data-minus="${escapeHtml(p.id)}">‚àí</button>
              <input class="qtyInput" inputmode="numeric" type="number" min="0" step="1"
                     value="${qty}" data-id="${escapeHtml(p.id)}" aria-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" />
              <button class="qtyBtn" type="button" data-plus="${escapeHtml(p.id)}">+</button>
              <button class="setBtn primary" type="button" data-set="${escapeHtml(p.id)}">–û–ö</button>
            </div>
          </div>

          <div class="clientHint2">–í –∫–æ—Ä–∑–∏–Ω–µ: <b id="inCart-${escapeHtml(p.id)}">${qty}</b></div>
        `;

        const input = card.querySelector(".qtyInput");
        const btnSet = card.querySelector("[data-set]");
        const btnPlus = card.querySelector("[data-plus]");
        const btnMinus = card.querySelector("[data-minus]");

        function syncUI(){
          input.value = String(cart.get(p.id) || 0);
          const b = card.querySelector(`#inCart-${CSS.escape(p.id)}`);
          if(b) b.textContent = String(cart.get(p.id) || 0);
        }

        function applyFromInput(){
          const id = input.getAttribute("data-id");
          setQty(id, input.value);
          syncUI();
          toast("–ì–æ—Ç–æ–≤–æ");
        }

        btnPlus.addEventListener("click", ()=>{
          const cur = Number(cart.get(p.id) || input.value || 0);
          setQty(p.id, cur + 1);
          syncUI();
        });

        btnMinus.addEventListener("click", ()=>{
          const cur = Number(cart.get(p.id) || input.value || 0);
          setQty(p.id, Math.max(0, cur - 1));
          syncUI();
        });

        btnSet.addEventListener("click", applyFromInput);
        input.addEventListener("keydown", (e)=>{ if(e.key==="Enter") applyFromInput(); });

        // –º—è–≥–∫–æ–µ –∞–≤—Ç–æ-–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ (–Ω–µ —Å–∫—Ä–æ–ª–ª–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É)
        let t=null;
        input.addEventListener("input", ()=>{
          clearTimeout(t);
          t=setTimeout(()=>{ 
            const id = input.getAttribute("data-id");
            setQty(id, input.value);
            syncUI();
          }, 350);
        });

        elProducts.appendChild(card);
      });

      updateBar();
    }

    // scroll to catalog
    scrollCatalogBtn.addEventListener("click", ()=>{
      document.getElementById("catalog").scrollIntoView({behavior:"smooth", block:"start"});
    });

    // cart modal
    function openCart(){
      renderCartModal();
      cartModal.classList.add("show");
      cartModal.setAttribute("aria-hidden","false");
    }
    function closeCart(){
      cartModal.classList.remove("show");
      cartModal.setAttribute("aria-hidden","true");
    }
    function renderCartModal(){
      const items = cartItems();
      cartModalBody.innerHTML = "";

      if(items.length===0){
        cartModalBody.innerHTML = `<div class="empty" style="grid-column:1/-1;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è</div>`;
        cartModalTotal.textContent = `0 ‚Ç∏`;
        return;
      }

      items.forEach(({p, qty})=>{
        const row = document.createElement("div");
        row.className = "cartRow";
        row.innerHTML = `
          <div class="cartImg">
            <img src="${p.img}" alt="${escapeHtml(p.name)}" onerror="this.style.display='none'">
          </div>
          <div class="cartInfo">
            <h4>${escapeHtml(p.name)}</h4>
            <small>${fmt(p.price)} ‚Ç∏ ‚Ä¢ —Å—É–º–º–∞: ${fmt(p.price * qty)} ‚Ç∏</small>
          </div>
          <div class="cartQty">
            <button class="qbtn" type="button" data-cminus="${escapeHtml(p.id)}">‚àí</button>
            <div class="qval">${qty}</div>
            <button class="qbtn" type="button" data-cplus="${escapeHtml(p.id)}">+</button>
          </div>
        `;
        cartModalBody.appendChild(row);

        row.querySelector("[data-cplus]").addEventListener("click", ()=>{
          setQty(p.id, (cart.get(p.id)||0) + 1);
        });
        row.querySelector("[data-cminus]").addEventListener("click", ()=>{
          setQty(p.id, Math.max(0, (cart.get(p.id)||0) - 1));
        });
      });

      cartModalTotal.textContent = `${fmt(cartTotal())} ‚Ç∏`;
    }

    cartModal.addEventListener("click", (e)=>{ if(e.target === cartModal) closeCart(); });
    closeCartBtn.addEventListener("click", closeCart);
    openCartBtn.addEventListener("click", openCart);
    elCartCount.addEventListener("click", openCart);
    elCartSum.addEventListener("click", openCart);

    clearCartBtn.addEventListener("click", ()=>{
      cart.clear();
      saveCart();
      renderProducts();
      updateBar();
      toast("–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞");
      if(cartModal.classList.contains("show")) renderCartModal();
    });

    cartModalClear.addEventListener("click", ()=>{
      cart.clear();
      saveCart();
      renderProducts();
      renderCartModal();
      updateBar();
      toast("–ö–æ—Ä–∑–∏–Ω–∞ –æ—á–∏—â–µ–Ω–∞");
    });

    function buildTextOrder(){
      const items = cartItems();
      const c = getClient();

      const lines = [];
      lines.push("–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –•–æ—á—É —Å–¥–µ–ª–∞—Ç—å –∑–∞–∫–∞–∑ ‚úÖ");
      lines.push(`–ò–º—è: ${c.name||"‚Äî"}`);
      lines.push(`–ì–æ—Ä–æ–¥: ${c.city||"‚Äî"}`);
      lines.push("");
      lines.push("üßæ –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤:");

      items.forEach((it, i)=>{
        const price = Number(it.p.price)||0;
        const sum = price * it.qty;
        lines.push(`${i+1}) ${it.p.name} ‚Äî ${it.qty} —à—Ç √ó ${fmt(price)} ‚Ç∏ = ${fmt(sum)} ‚Ç∏`);
      });

      lines.push("");
      lines.push(`–ò—Ç–æ–≥–æ: ${fmt(cartTotal())} ‚Ç∏`);
      return lines.join("\n");
    }

    // ‚úÖ –ù–∞–∂–∞–ª–∏ WhatsApp —Å–Ω–∏–∑—É -> –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É (–ø—Ä–æ—Å–º–æ—Ç—Ä –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π)
    btnWaText.addEventListener("click", ()=>{
      if(cartItems().length===0){ toast("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è"); return; }
      openCart();
    });

    cartModalSendWa.addEventListener("click", ()=>{
  const c = getClient();

  // ‚ùó –ò–º—è –ù–ï –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ
  // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≥–æ—Ä–æ–¥ (–µ—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –∏ –µ–≥–æ –º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å)
  if(!c.city){ 
    toast("–í–≤–µ–¥–∏—Ç–µ –≥–æ—Ä–æ–¥"); 
    clientCity.focus(); 
    return; 
  }

  const text = buildTextOrder();
  const url = `https://wa.me/${SHOP.phoneWa}?text=${encodeURIComponent(text)}`;
  window.open(url, "_blank");
});

    // PDF
    function fillPdfArea(){
      const items = cartItems();
      const c = getClient();

      pdfClientName.textContent = c.name ? c.name : "‚Äî";
      pdfClientCity.textContent = c.city ? c.city : "‚Äî";

      pdfRows.innerHTML = "";
      pdfDate.textContent = new Date().toLocaleString("ru-RU");

      if(items.length===0){
        pdfRows.innerHTML = `
          <tr>
            <td colspan="5" style="padding:12px; border:1px solid #e6e6e6; color:#666;">
              –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è
            </td>
          </tr>`;
        pdfTotal.textContent = "0 ‚Ç∏";
        return;
      }

      items.forEach(it=>{
        const price = Number(it.p.price)||0;
        const sum = price * it.qty;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td style="padding:8px; border:1px solid #e6e6e6;">
            <img src="${it.p.img}" crossorigin="anonymous"
                 style="width:48px; height:48px; object-fit:cover; border-radius:10px; border:1px solid #eee; background:#fff;"
                 onerror="this.style.display='none'">
          </td>
          <td style="padding:10px; border:1px solid #e6e6e6;">${escapeHtml(it.p.name)}</td>
          <td style="padding:10px; border:1px solid #e6e6e6; text-align:center;">${it.qty}</td>
          <td style="padding:10px; border:1px solid #e6e6e6; text-align:right;">${fmt(price)} ‚Ç∏</td>
          <td style="padding:10px; border:1px solid #e6e6e6; text-align:right;">${fmt(sum)} ‚Ç∏</td>
        `;
        pdfRows.appendChild(tr);
      });

      pdfTotal.textContent = `${fmt(cartTotal())} ‚Ç∏`;
    }

    async function makePdfBlob(){
      fillPdfArea();

      const imgs = Array.from(pdfArea.querySelectorAll("img"));
      await Promise.all(imgs.map(img => new Promise(res=>{
        if(!img.src) return res();
        if(img.complete) return res();
        img.onload = ()=>res();
        img.onerror = ()=>res();
      })));

      await new Promise(r=>setTimeout(r, 200));

      const canvas = await html2canvas(pdfArea, {
        scale: 2,
        useCORS: true,
        allowTaint: true,
        backgroundColor: "#ffffff"
      });
      const imgData = canvas.toDataURL("image/png");

      const { jsPDF } = window.jspdf;
      const pdf = new jsPDF("p", "pt", "a4");

      const pageW = pdf.internal.pageSize.getWidth();
      const pageH = pdf.internal.pageSize.getHeight();

      const imgW = pageW;
      const imgH = canvas.height * (imgW / canvas.width);

      let y = 0;
      pdf.addImage(imgData, "PNG", 0, y, imgW, imgH);

      let heightLeft = imgH - pageH;
      while(heightLeft > 0){
        pdf.addPage();
        y = - (imgH - heightLeft);
        pdf.addImage(imgData, "PNG", 0, y, imgW, imgH);
        heightLeft -= pageH;
      }

      return pdf.output("blob");
    }

    btnPdf.addEventListener("click", async ()=>{
      try{
        if(cartItems().length===0){ toast("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è"); return; }
        const blob = await makePdfBlob();
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "BUY.KANS_order.pdf";
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(()=> URL.revokeObjectURL(url), 4000);
        toast("PDF –≥–æ—Ç–æ–≤");
      }catch(e){
        console.error(e);
        toast("–û—à–∏–±–∫–∞ PDF");
      }
    });

    btnSharePdf.addEventListener("click", async ()=>{
      try{
        if(cartItems().length===0){ toast("–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞—è"); return; }
        const blob = await makePdfBlob();
        const file = new File([blob], "BUY.KANS_order.pdf", { type: "application/pdf" });

        if (navigator.share && (!navigator.canShare || navigator.canShare({ files:[file] }))) {
          try{
            await navigator.share({ title:"BUY.KANS ‚Äî –ó–∞–∫–∞–∑", text:"PDF –∑–∞–∫–∞–∑–∞", files:[file] });
            toast("Share");
            return;
          }catch(err){
            if(String(err).toLowerCase().includes("abort")) return;
          }
        }

        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "BUY.KANS_order.pdf";
        document.body.appendChild(a);
        a.click();
        a.remove();
        setTimeout(()=> URL.revokeObjectURL(url), 4000);
        toast("–°–∫–∞—á–∞–Ω–æ");
      }catch(e){
        console.error(e);
        toast("–ù–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å");
      }
    });

    // init
    loadClient();
    loadCart();
    renderProducts();
    updateBar();
  </script>
</body>
</html>
